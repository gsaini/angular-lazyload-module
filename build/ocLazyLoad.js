/**
 * original copyright: Andy Grom (https://github.com/AndyGrom/loadOnDemand)
 * rewrite by: Olivier Combe (https://github.com/ocombe/ocLazyLoad)
 */

(function(){function n(t){var n=[];return angular.forEach(t.requires,function(t){e.indexOf(t)===-1&&n.push(t)}),n}function r(e){try{angular.module(e)}catch(t){if(/No module/.test(t)||t.message.indexOf("$injector:nomod")>-1)return!1}return!0}function i(t,n,r){var i,s,o,u,a,f,l,c;if(n){var h=[];for(o=n.length-1;o>=0;o--){a=n[o],e.push(a),f=angular.module(a),h=h.concat(f._runBlocks);try{for(u=f._invokeQueue,i=0,s=u.length;i<s;i++){l=u[i];if(!t.hasOwnProperty(l[0]))return r.error("unsupported provider "+l[0]);c=t[l[0]],c[l[1]].apply(c,l[2])}}catch(p){throw p.message&&(p.message+=" from "+a),r.error(p.message),p}n.pop()}angular.forEach(h,function(e){t.$injector.invoke(e)})}return null}function s(t){function u(e){return e&&n.push(e)}var n=[t],r,i,s=["ng:app","ng-app","x-ng-app","data-ng-app"],o=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(s,function(e){s[e]=!0,u(document.getElementById(e)),e=e.replace(":","\\:"),t.querySelectorAll&&(angular.forEach(t.querySelectorAll("."+e),u),angular.forEach(t.querySelectorAll("."+e+"\\:"),u),angular.forEach(t.querySelectorAll("["+e+"]"),u))}),angular.forEach(n,function(e){if(!r){var n=" "+t.className+" ",u=o.exec(n);u?(r=e,i=(u[2]||"").replace(/\s+/g,",")):angular.forEach(e.attributes,function(t){!r&&s[t.name]&&(r=e,i=t.value)})}}),r&&function a(t){if(e.indexOf(t)===-1){e.push(t);var n=angular.module(t);angular.forEach(n.requires,a)}}(i)}var e=["ng","ngAnimate"],t=angular.module("oc.lazyLoad",["ng"]);t.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector",function(t,o,u,a,f){var l={},c,h={$controllerProvider:t,$compileProvider:u,$filterProvider:a,$provide:o,$injector:f};this.$get=["$timeout","$log","$q",function(t,s,o){return{getModuleConfig:function(e){return l[e]?l[e]:null},setModuleConfig:function(e){return l[e.name]=e,e},getModules:function(){return e},load:function(u){function v(i,o){function h(e){if(e){var n=f.indexOf(e);n>-1&&f.splice(n,1)}f.length===0&&t(function(){o(i)})}if(e.indexOf(i)>-1)return o();var u=angular.module(i),f=n(u),p=n(u);return angular.forEach(p,function(e){l.push(e);if(r(e))return h(e);var t=a.getConfig(e);return t&&typeof t.files!="undefined"?c(t.files,function(){v(e,function(t){h(t)})}):(s.warn('module "'+e+"' not loaded and not configured"),h(e)),null}),p.length===0&&h(),null}var a=this,f,l=[],p=o.defer();typeof u=="string"?f=a.getModuleConfig(u):typeof u=="object"&&typeof u.name!="undefined"&&(f=a.setModuleConfig(u),u=u.name),l.push=function(e){this.indexOf(e)===-1&&Array.prototype.push.apply(this,arguments)};if(!f){var d='Module "'+u+'" not configured';throw s.error(d),d}return c(f.files,function(){l.push(u),v(u,function(){i(h,l,s),t(function(){p.resolve(f)})})}),p.promise}}}],this.config=function(e){if(typeof e.asyncLoader=="undefined")throw"You need to define an async loader such as requireJS or script.js";c=e.asyncLoader,s(angular.element(window.document)),typeof e.modules!="undefined"&&(angular.isArray(e.modules)?angular.forEach(e.modules,function(e){l[e.name]=e}):l[e.modules.name]=e.modules)}}]),t.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache",function(e,t,n,r,i,s){return{link:function(i,o,u){function l(){a&&(a.$destroy(),a=null),o.html("")}function c(n,r){var i;typeof (i=s.get(n))!="undefined"?r(i):e.get(n).success(function(e){s.put("view:"+n,e),r(e)}).error(function(e){t.error('Error load template "'+n+"': "+e)})}var a,f=i.$eval(u.ocLazyLoad).onload||"";i.$watch(u.ocLazyLoad,function(e){e?n.load(e).then(function(e){if(!e.template)return;c(e.template,function(e){a=i.$new(),o.html(e);var t=o.contents(),n=r(t);n(a),a.$emit("$includeContentLoaded"),a.$eval(f)})}):l()})}}}])})();